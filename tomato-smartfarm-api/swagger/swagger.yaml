openapi: 3.0.3
info:
  title: ğŸ… í† ë§ˆí†  ìŠ¤ë§ˆíŠ¸íŒœ API
  description: |
    ## ê°œìš”
    SEED FARM í† ë§ˆí†  ìŠ¤ë§ˆíŠ¸íŒœ ê´€ë¦¬ ì‹œìŠ¤í…œì˜ REST API ë¬¸ì„œì…ë‹ˆë‹¤.
    
    ì´ APIëŠ” n8n ì›Œí¬í”Œë¡œìš° ê¸°ë°˜ìœ¼ë¡œ êµ¬í˜„ë˜ì–´ ìˆìœ¼ë©°, ë‹¤ìŒ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤:
    
    - ğŸ¥ **ì¹´ë©”ë¼ ì œì–´**: ë¼ì¦ˆë² ë¦¬íŒŒì´ ì¹´ë©”ë¼ ì›ê²© ì œì–´
    - ğŸ“Š **ë°ì´í„° ì¡°íšŒ**: ì‹¤ì‹œê°„/íˆìŠ¤í† ë¦¬/ìš”ì•½ ë°ì´í„° ì¡°íšŒ
    - ğŸ¤– **AI ë¶„ì„**: YOLO ê¸°ë°˜ í† ë§ˆí†  ë¶„ì„, AI ì±—ë´‡
    - ğŸ’° **ì‹œì¥ ê°€ê²©**: KAMIS ë„ë§¤ê°€, ì˜¨ë¼ì¸ ê°€ê²© ë¹„êµ
    - ğŸŒ± **ìˆ˜í™•ëŸ‰ ì˜ˆì¸¡**: ML ëª¨ë¸ ê¸°ë°˜ ì˜ˆì¸¡
    - ğŸ“ **ë†ì¥ ì¼ì§€**: ì¼ì§€ ì¡°íšŒ/ì €ì¥
    
    ## ì„œë²„ í™˜ê²½
    - **ìš´ì˜ ì„œë²„**: http://seedfarm.co.kr:5678
    - **ë‚´ë¶€ ì„œë²„**: http://192.168.49.101:5679
    
    ## ì¸ì¦
    í˜„ì¬ API í‚¤ ì¸ì¦ì´ í•„ìš”í•œ ì—”ë“œí¬ì¸íŠ¸ëŠ” `api_key` íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
    
    ## ìµœì¢… í…ŒìŠ¤íŠ¸ì¼
    2025-11-28 (ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ ì •ìƒ ì‘ë™ í™•ì¸)
    
  version: 1.1.0
  contact:
    name: SEED FARM ê°œë°œíŒ€
    email: dev@seedfarm.co.kr
  license:
    name: ISC

servers:
  - url: http://seedfarm.co.kr:5678/webhook
    description: ìš´ì˜ ì„œë²„ (ì™¸ë¶€ ì ‘ê·¼ìš©)
  - url: http://192.168.49.101:5679/webhook
    description: ë‚´ë¶€ ì„œë²„ (ì‚¬ë‚´ë§ ì „ìš©)

tags:
  - name: ğŸ“Š Data
    description: í† ë§ˆí†  ë¶„ì„ ë°ì´í„° ì¡°íšŒ API
  - name: ğŸ¥ Camera
    description: ë¼ì¦ˆë² ë¦¬íŒŒì´ ì¹´ë©”ë¼ ì œì–´ API
  - name: ğŸ¤– AI
    description: AI ì±—ë´‡ ë° ì´ë¯¸ì§€ ë¶„ì„ API
  - name: ğŸ’° Market
    description: ì‹œì¥ ê°€ê²© ì •ë³´ API
  - name: ğŸŒ± Prediction
    description: ìˆ˜í™•ëŸ‰ ì˜ˆì¸¡ API
  - name: ğŸ“ Diary
    description: ë†ì¥ ì¼ì§€ API
  - name: ğŸ  Home
    description: ì•± í™ˆ í™”ë©´ìš© í†µí•© API

paths:
  # ===== ë°ì´í„° ì¡°íšŒ API =====
  /data-realtime:
    get:
      tags:
        - ğŸ“Š Data
      summary: ì‹¤ì‹œê°„ í† ë§ˆí†  ë¶„ì„ ë°ì´í„° ì¡°íšŒ
      description: |
        ìµœê·¼ 1ì‹œê°„ ì´ë‚´ì˜ ë§ˆì§€ë§‰ YOLO ë¶„ì„ ê²°ê³¼ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
        
        **ë°ì´í„° ì¶œì²˜**: InfluxDB (bucket: minwoo, measurement: predict)
        
        **ì°¸ê³ **: ìµœê·¼ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ëª¨ë‘ 0ìœ¼ë¡œ ë°˜í™˜ë©ë‹ˆë‹¤.
      operationId: getRealtimeData
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TomatoData'
              example:
                Ready: 45
                Not_Ready: 23
                Disease_Bad: 2
                Truss: 8
        '500':
          description: ì„œë²„ ì˜¤ë¥˜
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /data-history:
    get:
      tags:
        - ğŸ“Š Data
      summary: ê³¼ê±° í† ë§ˆí†  ë¶„ì„ ë°ì´í„° ì¡°íšŒ
      description: |
        ì§€ì •ëœ ì‹œê°„ ë²”ìœ„ì˜ ì‹œê³„ì—´ ë°ì´í„°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
        
        **ì‚¬ìš© ì˜ˆì‹œ**:
        - ìµœê·¼ 30ë¶„: `?hours=0.5`
        - ìµœê·¼ 24ì‹œê°„: `?hours=24`
        - ìµœê·¼ 1ì£¼ì¼: `?hours=168`
      operationId: getHistoryData
      parameters:
        - name: hours
          in: query
          description: ì¡°íšŒ ê¸°ê°„ (ì‹œê°„ ë‹¨ìœ„)
          required: false
          schema:
            type: number
            default: 1
            example: 24
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/TomatoDataWithTime'
              example:
                data:
                  - time: "2025-11-27T01:25:45Z"
                    Ready: 25
                    Not_Ready: 8
                    Disease_Bad: 4
                    Truss: 4
                  - time: "2025-11-27T01:26:55Z"
                    Ready: 23
                    Not_Ready: 13
                    Disease_Bad: 0
                    Truss: 12

  /data-summary:
    get:
      tags:
        - ğŸ“Š Data
      summary: ì˜¤ëŠ˜ ì¼ì¼ ìš”ì•½ ë°ì´í„° ì¡°íšŒ
      description: |
        ì˜¤ëŠ˜ 00:00:00 (KST) ë¶€í„° í˜„ì¬ê¹Œì§€ì˜ ë§ˆì§€ë§‰ ë°ì´í„°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
        
        **ì°¸ê³ **: ì˜¤ëŠ˜ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ëª¨ë‘ 0ìœ¼ë¡œ ë°˜í™˜ë©ë‹ˆë‹¤.
      operationId: getDailySummary
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DailySummary'
              example:
                total_ready: 0
                total_not_ready: 0
                total_disease: 0
                avg_truss: 0

  # ===== ì¹´ë©”ë¼ ì œì–´ API =====
  /camera-capture:
    post:
      tags:
        - ğŸ¥ Camera
      summary: ì¦‰ì‹œ ì´¬ì˜ ë° ë¶„ì„
      description: |
        ë¼ì¦ˆë² ë¦¬íŒŒì´ ì¹´ë©”ë¼ë¡œ ì¦‰ì‹œ ì´¬ì˜í•˜ê³  YOLO ë¶„ì„ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
        
        **ì²˜ë¦¬ ìˆœì„œ**:
        1. ë¼ì¦ˆë² ë¦¬íŒŒì´ ìŠ¤ëƒ…ìƒ· ìš”ì²­ (192.168.49.219:8080)
        2. YOLO ì„œë²„ë¡œ ì´ë¯¸ì§€ ì „ì†¡
        3. ë¶„ì„ ê²°ê³¼ InfluxDB ì €ì¥
        4. ê²°ê³¼ ë°˜í™˜
      operationId: captureNow
      responses:
        '200':
          description: ì´¬ì˜ ë° ë¶„ì„ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CaptureResponse'
              example:
                success: true
                data:
                  Ready: 35
                  Not_Ready: 18
                  Disease_Bad: 2
                  Truss: 6
                  ripeness_rate: 66
                  disease_rate: 4
                timestamp: "2025-11-28T00:10:00Z"
        '500':
          description: ì´¬ì˜ ì‹¤íŒ¨

  /capture-test:
    post:
      tags:
        - ğŸ¥ Camera
      summary: í…ŒìŠ¤íŠ¸ ì´¬ì˜ (ëœë¤ ë°ì´í„°)
      description: |
        ë¼ì¦ˆë² ë¦¬íŒŒì´ ì—†ì´ í…ŒìŠ¤íŠ¸ìš© ëœë¤ ë°ì´í„°ë¥¼ ìƒì„±í•˜ê³  InfluxDBì— ì €ì¥í•©ë‹ˆë‹¤.
        
        **ê°œë°œ/í…ŒìŠ¤íŠ¸ ìš©ë„**ë¡œë§Œ ì‚¬ìš©í•˜ì„¸ìš”.
        
        **ìƒì„± ë²”ìœ„**:
        - Ready: 10~60
        - Not_Ready: 5~35
        - Disease_Bad: 0~5
        - Truss: 3~18
      operationId: captureTest
      responses:
        '200':
          description: í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CaptureTestResponse'
              example:
                success: true
                message: "í…ŒìŠ¤íŠ¸ ì´¬ì˜ ì™„ë£Œ - ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤"
                timestamp: "2025-11-28T00:10:49.414Z"
                data:
                  Ready: 27
                  Not_Ready: 10
                  Disease_Bad: 1
                  Truss: 14

  /camera-start:
    post:
      tags:
        - ğŸ¥ Camera
      summary: ìë™ ëª¨ë‹ˆí„°ë§ ì‹œì‘
      description: ì„¤ì •ëœ ê°„ê²©ìœ¼ë¡œ ìë™ ì´¬ì˜ì„ ì‹œì‘í•©ë‹ˆë‹¤.
      operationId: startMonitoring
      responses:
        '200':
          description: ëª¨ë‹ˆí„°ë§ ì‹œì‘ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CameraStatusResponse'

  /camera-stop:
    post:
      tags:
        - ğŸ¥ Camera
      summary: ìë™ ëª¨ë‹ˆí„°ë§ ì¤‘ì§€
      description: ìë™ ì´¬ì˜ì„ ì¤‘ì§€í•©ë‹ˆë‹¤.
      operationId: stopMonitoring
      responses:
        '200':
          description: ëª¨ë‹ˆí„°ë§ ì¤‘ì§€ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CameraStatusResponse'

  /camera-status:
    get:
      tags:
        - ğŸ¥ Camera
      summary: ì¹´ë©”ë¼ ìƒíƒœ ì¡°íšŒ
      description: |
        í˜„ì¬ ì¹´ë©”ë¼ì˜ ëª¨ë‹ˆí„°ë§ ìƒíƒœ, ì„¤ì •ì„ ì¡°íšŒí•©ë‹ˆë‹¤.
        
        **ì‹¤ì œ ì‘ë‹µ í™•ì¸ì¼**: 2025-11-28
      operationId: getCameraStatus
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CameraStatus'
              example:
                streaming: true
                camera_ready: true
                has_frame: true
                monitoring: false
                interval: 600
                white_balance: "auto"
                last_capture: null
        '500':
          description: ì¹´ë©”ë¼ ì„œë²„ ì—°ê²° ì‹¤íŒ¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Error in workflow"

  /camera-interval:
    post:
      tags:
        - ğŸ¥ Camera
      summary: ì´¬ì˜ ê°„ê²© ì„¤ì •
      description: |
        ìë™ ì´¬ì˜ ê°„ê²©ì„ ì„¤ì •í•©ë‹ˆë‹¤.
        
        **í—ˆìš© ê°’**: 60(1ë¶„), 300(5ë¶„), 600(10ë¶„), 1800(30ë¶„), 3600(1ì‹œê°„)
      operationId: setCaptureInterval
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - interval
              properties:
                interval:
                  type: integer
                  description: ì´¬ì˜ ê°„ê²© (ì´ˆ)
                  enum: [60, 300, 600, 1800, 3600]
                  example: 600
      responses:
        '200':
          description: ì„¤ì • ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CameraStatusResponse'

  /camera-white-balance:
    post:
      tags:
        - ğŸ¥ Camera
      summary: í™”ì´íŠ¸ ë°¸ëŸ°ìŠ¤ ì„¤ì •
      description: ì¹´ë©”ë¼ í™”ì´íŠ¸ ë°¸ëŸ°ìŠ¤ ëª¨ë“œë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
      operationId: setWhiteBalance
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - mode
              properties:
                mode:
                  type: string
                  description: í™”ì´íŠ¸ ë°¸ëŸ°ìŠ¤ ëª¨ë“œ
                  enum: [auto, fluorescent, tungsten, daylight]
                  example: auto
      responses:
        '200':
          description: ì„¤ì • ì„±ê³µ

  # ===== AI API =====
  /chat-message:
    post:
      tags:
        - ğŸ¤– AI
      summary: AI ì±—ë´‡ ë©”ì‹œì§€ ì „ì†¡
      description: |
        í† ë§ˆí†  ì¬ë°° ê´€ë ¨ AI ì–´ì‹œìŠ¤í„´íŠ¸ì—ê²Œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.
        
        **ê¸°ëŠ¥**:
        - í…ìŠ¤íŠ¸ë§Œ ì „ì†¡: ì¬ë°° ê´€ë ¨ ì§ˆë¬¸ ë‹µë³€
        - í…ìŠ¤íŠ¸ + ì´ë¯¸ì§€: YOLO ë¶„ì„ í›„ ë§ì¶¤ ì¡°ì–¸
        
        **ì‚¬ìš© ëª¨ë¸**: Google Gemini
      operationId: sendChatMessage
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - message
              properties:
                message:
                  type: string
                  description: ì‚¬ìš©ì ë©”ì‹œì§€
                  example: "í† ë§ˆí†  ì¬ë°°ì— ì í•©í•œ ì˜¨ë„ëŠ”?"
                image:
                  type: string
                  format: binary
                  description: í† ë§ˆí†  ì´ë¯¸ì§€ (ì„ íƒ)
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatResponse'
              example:
                response: "ì•ˆë…•! ğŸ‘‹ ë°˜ê°€ì›Œìš”! ì €ëŠ” ë‹¹ì‹ ì˜ ì¹œê·¼í•œ í† ë§ˆí†  ì¬ë°° ë„ìš°ë¯¸ì˜ˆìš”. í† ë§ˆí†  í‚¤ìš°ëŠ” ë° ê¶ê¸ˆí•œ ì ì´ ìˆë‹¤ë©´ ì–¸ì œë“ ì§€ ë¬¼ì–´ë³´ì„¸ìš”! ğŸ…"
                timestamp: "2025-11-28T00:14:00.412Z"
                success: true

  /capture-analyze:
    post:
      tags:
        - ğŸ¤– AI
      summary: ì´ë¯¸ì§€ YOLO ë¶„ì„ (Base64)
      description: |
        Base64 ì¸ì½”ë”©ëœ ì´ë¯¸ì§€ë¥¼ YOLOë¡œ ë¶„ì„í•©ë‹ˆë‹¤.
        
        **ì•±ì—ì„œ ì‚¬ìš©**: ì¹´ë©”ë¼ë¡œ ì´¬ì˜ í›„ ë°”ë¡œ ë¶„ì„í•  ë•Œ
      operationId: analyzeImage
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - image
              properties:
                image:
                  type: string
                  description: Base64 ì¸ì½”ë”©ëœ ì´ë¯¸ì§€
                mimeType:
                  type: string
                  default: "image/jpeg"
                fileName:
                  type: string
                  default: "capture.jpg"
      responses:
        '200':
          description: ë¶„ì„ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyzeResponse'

  /disease-diagnosis:
    post:
      tags:
        - ğŸ¤– AI
      summary: ë³‘í•´ì¶© AI ì§„ë‹¨
      description: |
        í† ë§ˆí†  ì´ë¯¸ì§€ë¥¼ AIë¡œ ë¶„ì„í•˜ì—¬ ë³‘í•´ì¶©ì„ ì§„ë‹¨í•©ë‹ˆë‹¤.
        
        **ì§„ë‹¨ í•­ëª©**:
        - ê±´ê°• ìƒíƒœ í‰ê°€ (ê±´ê°•/ì£¼ì˜/ìœ„í—˜)
        - ë°œê²¬ëœ ì¦ìƒ
        - ì›ì¸ ë¶„ì„
        - ê¸´ê¸‰ ì¡°ì¹˜
        - ì¹˜ë£Œ ë°©ë²•
        - ì˜ˆë°© ê´€ë¦¬
      operationId: diagnoseDiseases
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - image
              properties:
                image:
                  type: string
                  description: Base64 ì¸ì½”ë”©ëœ ì´ë¯¸ì§€
                mimeType:
                  type: string
                  default: "image/jpeg"
      responses:
        '200':
          description: ì§„ë‹¨ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DiagnosisResponse'

  /raspberry-image:
    post:
      tags:
        - ğŸ¤– AI
      summary: ë¼ì¦ˆë² ë¦¬íŒŒì´ ì´ë¯¸ì§€ ìˆ˜ì‹ 
      description: |
        ë¼ì¦ˆë² ë¦¬íŒŒì´ì—ì„œ ì „ì†¡í•œ ì´ë¯¸ì§€ë¥¼ ìˆ˜ì‹ í•˜ê³  ìë™ìœ¼ë¡œ YOLO ë¶„ì„ í›„ InfluxDBì— ì €ì¥í•©ë‹ˆë‹¤.
        
        **ìë™ ì²˜ë¦¬ í”Œë¡œìš°**:
        1. ì´ë¯¸ì§€ ìˆ˜ì‹ 
        2. YOLO ë¶„ì„
        3. InfluxDB ì €ì¥
        4. ì´ë¯¸ì§€ íŒŒì¼ ì €ì¥ (ê¹€ì œ_ì‹¤ì¦_ë°ì´í„°ì €ì¥ì†Œ)
      operationId: receiveRaspberryImage
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - image
              properties:
                image:
                  type: string
                  format: binary
                  description: JPEG ì´ë¯¸ì§€
      responses:
        '200':
          description: ì²˜ë¦¬ ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  timestamp:
                    type: string
                    format: date-time

  # ===== ì‹œì¥ ê°€ê²© API =====
  /market-price:
    get:
      tags:
        - ğŸ’° Market
      summary: ì˜¤ëŠ˜ ì‹œì¥ ê°€ê²© ì¡°íšŒ
      description: |
        KAMIS APIë¥¼ í†µí•´ ì˜¤ëŠ˜ì˜ í† ë§ˆí†  ë„ë§¤ ê°€ê²©ì„ ì¡°íšŒí•©ë‹ˆë‹¤.
        
        **ë°ì´í„° ì¶œì²˜**: ë†ì‚°ë¬¼ìœ í†µì •ë³´ (KAMIS)
        
        **ê°€ê²© ë‹¨ìœ„**: ì›/kg (p_convert_kg_yn=Y)
      operationId: getMarketPrice
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MarketPrice'
              example:
                success: true
                data:
                  item_name: "í† ë§ˆí† "
                  kind_name: "í† ë§ˆí† (1kg)"
                  unit: "5kg"
                  rank: "ìƒí’ˆ"
                  price: 3480
                  yesterday_price: 3560
                  week_ago_price: 4200
                  two_week_ago_price: 4960
                  month_ago_price: 25547
                  year_ago_price: 30509
                  change: -80
                  change_rate: -2.2
                  direction: "down"
                  date: "ë‹¹ì¼ (11/27)"
                  market: "ì „êµ­ ë„ë§¤ì‹œì¥"

  /price-compare:
    get:
      tags:
        - ğŸ’° Market
      summary: ë„ë§¤ê°€ vs ì˜¨ë¼ì¸ê°€ ë¹„êµ
      description: |
        KAMIS ë„ë§¤ê°€ì™€ ë„¤ì´ë²„ ì‡¼í•‘ ì˜¨ë¼ì¸ê°€ë¥¼ ë¹„êµí•©ë‹ˆë‹¤.
        
        **ë¹„êµ í•­ëª©**:
        - ë„ë§¤ê°€: KAMIS (ìƒí’ˆ/ì¤‘í’ˆ/ë°©ìš¸í† ë§ˆí† )
        - ì˜¨ë¼ì¸ê°€: ë„¤ì´ë²„ ì‡¼í•‘ (ì™„ìˆ™í† ë§ˆí†  1kg ê¸°ì¤€)
        - ë§ˆì§„ìœ¨ ê³„ì‚°
      operationId: comparePrices
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PriceCompare'
              example:
                success: true
                date: "2025-11-27"
                wholesale_summary:
                  high: 3480
                  mid: 3120
                  cherry: 6200
                online_summary:
                  lowest_price: 5800
                  lowest_mall: "ì±„ì†ŒíŒœ"
                  lowest_title: "ì±„ì†ŒíŒœ ì™„ìˆ™í† ë§ˆí†  1kg"
                  lowest_link: "https://smartstore.naver.com/main/products/10914338580"
                  median_price: 14700
                  highest_price: 23500
                  average_price: 14398
                  mall_count: 49
                comparison:
                  - grade: "ìƒí’ˆ"
                    wholesale_price: 3480
                    online_lowest: 5800
                    margin_rate: 67
                  - grade: "ì¤‘í’ˆ"
                    wholesale_price: 3120
                    online_lowest: 5800
                    margin_rate: 86
                sample_count: 49

  /price-history:
    get:
      tags:
        - ğŸ’° Market
      summary: ê°€ê²© ì¶”ì´ ì¡°íšŒ
      description: |
        ì§€ì • ê¸°ê°„ì˜ í† ë§ˆí†  ê°€ê²© ì¶”ì´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
        
        **ê¸°ë³¸ê°’**: ìµœê·¼ 7ì¼
        
        **ì°¸ê³ **: ì£¼ë§/ê³µíœ´ì¼ ë°ì´í„°ëŠ” ì œì™¸ë©ë‹ˆë‹¤.
      operationId: getPriceHistory
      parameters:
        - name: start
          in: query
          description: ì‹œì‘ì¼ (YYYY-MM-DD)
          required: false
          schema:
            type: string
            format: date
            example: "2025-11-20"
        - name: end
          in: query
          description: ì¢…ë£Œì¼ (YYYY-MM-DD)
          required: false
          schema:
            type: string
            format: date
            example: "2025-11-27"
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PriceHistory'
              example:
                success: true
                period:
                  start: "2025-11-20"
                  end: "2025-11-27"
                count: 6
                data:
                  - date: "2025-11-20"
                    high: 4200
                    mid: 3640
                    cherry: 8000
                  - date: "2025-11-21"
                    high: 4120
                    mid: 3520
                    cherry: 7530
                  - date: "2025-11-24"
                    high: 4000
                    mid: 3400
                    cherry: 7460
                  - date: "2025-11-25"
                    high: 3680
                    mid: 3200
                    cherry: 6930
                  - date: "2025-11-26"
                    high: 3560
                    mid: 3160
                    cherry: 6660
                  - date: "2025-11-27"
                    high: 3480
                    mid: 3120
                    cherry: 6200
                stats:
                  high:
                    min: 3480
                    max: 4200
                    avg: 3840
                    change: -720
                  mid:
                    min: 3120
                    max: 3640
                    avg: 3340
                    change: -520
                  cherry:
                    min: 6200
                    max: 8000
                    avg: 7130
                    change: -1800

  # ===== ìˆ˜í™•ëŸ‰ ì˜ˆì¸¡ API =====
  /yield-prediction:
    post:
      tags:
        - ğŸŒ± Prediction
      summary: ìˆ˜í™•ëŸ‰ ì˜ˆì¸¡
      description: |
        ML ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ ìˆ˜í™•ëŸ‰ì„ ì˜ˆì¸¡í•©ë‹ˆë‹¤.
        
        **ëª¨ë¸ ì •ë³´**:
        - ì‚¬ìš© ëª¨ë¸: v3_vinyl (ë¹„ë‹í•˜ìš°ìŠ¤), v3_glass (ìœ ë¦¬ì˜¨ì‹¤)
        - ì •í™•ë„: RÂ² = 0.9084
        - í•™ìŠµ ë°ì´í„°: 103,000+ ê±´
        
        **í•„ìˆ˜ ì…ë ¥**: temperature, humidity
        **ì„ íƒ ì…ë ¥**: month, co2, solar_radiation, growth_stage, facility_type
      operationId: predictYield
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/YieldPredictionRequest'
            example:
              temperature: 25
              humidity: 70
      responses:
        '200':
          description: ì˜ˆì¸¡ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/YieldPredictionResponse'
              example:
                success: true
                predicted_yield: 2693.77
                predicted_yield_total: 816294.06
                confidence_interval:
                  lower: 2289.7
                  upper: 3097.84
                  confidence_level: "85%"
                model_used: "v3_vinyl"
                input_summary:
                  temperature: 25
                  humidity: 70
                  month: 11
                  facility_type: "ë¹„ë‹í•˜ìš°ìŠ¤"
                  area: 1000
                  has_historical_data: false
                recommendations:
                  - "âœ… í˜„ì¬ í™˜ê²½ ì¡°ê±´ì´ ì–‘í˜¸í•©ë‹ˆë‹¤. í˜„ ìƒíƒœë¥¼ ìœ ì§€í•˜ì„¸ìš”."

  # ===== ë†ì¥ ì¼ì§€ API =====
  /app/diary:
    get:
      tags:
        - ğŸ“ Diary
      summary: ë†ì¥ ì¼ì§€ ì¡°íšŒ
      description: ì§€ì •ëœ ê¸°ê°„ì˜ ë†ì¥ ì¼ì§€(ë¶„ì„ ê¸°ë¡)ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
      operationId: getDiary
      parameters:
        - name: days
          in: query
          description: ì¡°íšŒ ê¸°ê°„ (ì¼)
          required: false
          schema:
            type: integer
            default: 7
            example: 7
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DiaryListResponse'

    post:
      tags:
        - ğŸ“ Diary
      summary: ë†ì¥ ì¼ì§€ ì €ì¥
      description: ì˜¤ëŠ˜ì˜ ìˆ˜í™•ëŸ‰ê³¼ ë©”ëª¨ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
      operationId: saveDiary
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DiaryEntry'
            example:
              date: "2025-11-28"
              harvest_kg: 15.5
              memo: "ì˜¤ëŠ˜ ë³‘í•´ í† ë§ˆí†  3ê°œ ì œê±°"
      responses:
        '200':
          description: ì €ì¥ ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  saved:
                    $ref: '#/components/schemas/DiaryEntry'

  # ===== í™ˆ API =====
  /app/home:
    get:
      tags:
        - ğŸ  Home
      summary: í™ˆ í™”ë©´ í†µí•© ë°ì´í„°
      description: |
        ì•± í™ˆ í™”ë©´ì— í•„ìš”í•œ ëª¨ë“  ë°ì´í„°ë¥¼ í†µí•©í•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤.
        
        **í¬í•¨ ì •ë³´**:
        - ì‹¤ì‹œê°„ í† ë§ˆí†  ë¶„ì„ ë°ì´í„°
        - ì˜¤ëŠ˜ ìš”ì•½ (ì„±ìˆ™ë¥  í¬í•¨)
        - ì•Œë¦¼ (ë³‘í•´ ê°ì§€, ìˆ˜í™• ì ê¸° ë“±)
        - ìŠ¤íŠ¸ë¦¬ë° URL
      operationId: getHomeData
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HomeData'
              example:
                success: true
                realtime:
                  ready: 27
                  not_ready: 10
                  disease: 1
                  truss: 14
                today_summary:
                  total_detected: 38
                  total_ready: 27
                  total_disease: 1
                  harvest_rate: 73
                alerts:
                  - type: "disease"
                    message: "ë³‘í•´ í† ë§ˆí†  1ê°œ ê°ì§€"
                    time: "2025-11-28T00:11:08.437Z"
                    severity: "medium"
                stream_url: "http://seedfarm.co.kr:5678/stream"
                last_updated: "2025-11-28T00:11:08.437Z"

components:
  schemas:
    TomatoData:
      type: object
      description: YOLO ë¶„ì„ ê²°ê³¼ (ëŒ€ë¬¸ì í•„ë“œ)
      properties:
        Ready:
          type: integer
          description: ìˆ˜í™• ê°€ëŠ¥í•œ ì™„ìˆ™ í† ë§ˆí†  ìˆ˜
          example: 45
        Not_Ready:
          type: integer
          description: ë¯¸ì„±ìˆ™ í† ë§ˆí†  ìˆ˜
          example: 23
        Disease_Bad:
          type: integer
          description: ë³‘í•´ì¶© ê°ì—¼ í† ë§ˆí†  ìˆ˜
          example: 2
        Truss:
          type: integer
          description: í™”ë°©(ê½ƒë´‰ìš°ë¦¬) ìˆ˜
          example: 8

    TomatoDataLowerCase:
      type: object
      description: YOLO ë¶„ì„ ê²°ê³¼ (ì†Œë¬¸ì í•„ë“œ - ì•±ìš©)
      properties:
        ready:
          type: integer
          example: 27
        not_ready:
          type: integer
          example: 10
        disease:
          type: integer
          example: 1
        truss:
          type: integer
          example: 14

    TomatoDataWithTime:
      type: object
      properties:
        time:
          type: string
          format: date-time
        Ready:
          type: integer
        Not_Ready:
          type: integer
        Disease_Bad:
          type: integer
        Truss:
          type: integer

    DailySummary:
      type: object
      properties:
        total_ready:
          type: integer
          description: ì´ ìˆ˜í™• ê°€ëŠ¥ í† ë§ˆí† 
        total_not_ready:
          type: integer
          description: ì´ ë¯¸ì„±ìˆ™ í† ë§ˆí† 
        total_disease:
          type: integer
          description: ì´ ë³‘í•´ í† ë§ˆí† 
        avg_truss:
          type: integer
          description: í‰ê·  í™”ë°© ìˆ˜

    CameraStatus:
      type: object
      description: ì¹´ë©”ë¼ ìƒíƒœ (ì‹¤ì œ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë°˜ì˜)
      properties:
        streaming:
          type: boolean
          description: ìŠ¤íŠ¸ë¦¬ë° í™œì„±í™” ì—¬ë¶€
          example: true
        camera_ready:
          type: boolean
          description: ì¹´ë©”ë¼ ì¤€ë¹„ ìƒíƒœ
          example: true
        has_frame:
          type: boolean
          description: í”„ë ˆì„ ì¡´ì¬ ì—¬ë¶€
          example: true
        monitoring:
          type: boolean
          description: ìë™ ëª¨ë‹ˆí„°ë§ í™œì„±í™” ì—¬ë¶€
          example: false
        interval:
          type: integer
          description: ì´¬ì˜ ê°„ê²© (ì´ˆ)
          example: 600
        white_balance:
          type: string
          description: í™”ì´íŠ¸ ë°¸ëŸ°ìŠ¤ ëª¨ë“œ
          enum: [auto, fluorescent, tungsten, daylight]
          example: "auto"
        last_capture:
          type: string
          format: date-time
          nullable: true
          description: ë§ˆì§€ë§‰ ì´¬ì˜ ì‹œê°„
          example: null

    CameraStatusResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        status:
          $ref: '#/components/schemas/CameraStatus'

    CaptureResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            Ready:
              type: integer
            Not_Ready:
              type: integer
            Disease_Bad:
              type: integer
            Truss:
              type: integer
            ripeness_rate:
              type: integer
              description: ì„±ìˆ™ë¥  (%)
            disease_rate:
              type: integer
              description: ë³‘í•´ìœ¨ (%)
        timestamp:
          type: string
          format: date-time

    CaptureTestResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
          example: "í…ŒìŠ¤íŠ¸ ì´¬ì˜ ì™„ë£Œ - ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤"
        timestamp:
          type: string
          format: date-time
        data:
          $ref: '#/components/schemas/TomatoData'

    ChatResponse:
      type: object
      properties:
        response:
          type: string
          description: AI ì‘ë‹µ ë©”ì‹œì§€
        timestamp:
          type: string
          format: date-time
        success:
          type: boolean

    AnalyzeResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            Ready:
              type: integer
            Not_Ready:
              type: integer
            Disease_Bad:
              type: integer
            Truss:
              type: integer
            ripeness_rate:
              type: integer
            disease_rate:
              type: integer

    DiagnosisResponse:
      type: object
      properties:
        success:
          type: boolean
        diagnosis:
          type: string
          description: AI ë³‘í•´ì¶© ì§„ë‹¨ ê²°ê³¼ (ë§ˆí¬ë‹¤ìš´ í˜•ì‹)
        healthStatus:
          type: string
          enum: [ê±´ê°•, ì£¼ì˜, ìœ„í—˜, ì˜¤ë¥˜]
          description: ê±´ê°• ìƒíƒœ íŒì •
        timestamp:
          type: string
          format: date-time

    MarketPrice:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            item_name:
              type: string
              example: "í† ë§ˆí† "
            kind_name:
              type: string
              example: "í† ë§ˆí† (1kg)"
            unit:
              type: string
              example: "5kg"
            rank:
              type: string
              example: "ìƒí’ˆ"
            price:
              type: integer
              description: ì˜¤ëŠ˜ ê°€ê²© (ì›/kg)
              example: 3480
            yesterday_price:
              type: integer
              description: ì–´ì œ ê°€ê²©
              example: 3560
            week_ago_price:
              type: integer
              description: ì¼ì£¼ì¼ ì „ ê°€ê²©
              example: 4200
            two_week_ago_price:
              type: integer
              description: 2ì£¼ ì „ ê°€ê²©
              example: 4960
            month_ago_price:
              type: integer
              description: í•œë‹¬ ì „ ê°€ê²©
              example: 25547
            year_ago_price:
              type: integer
              description: 1ë…„ ì „ ê°€ê²©
              example: 30509
            change:
              type: integer
              description: ì „ì¼ ëŒ€ë¹„ ê°€ê²© ë³€ë™
              example: -80
            change_rate:
              type: number
              description: ë³€ë™ë¥  (%)
              example: -2.2
            direction:
              type: string
              enum: [up, down, same]
              example: "down"
            date:
              type: string
              description: ì¡°íšŒ ê¸°ì¤€ì¼
              example: "ë‹¹ì¼ (11/27)"
            market:
              type: string
              example: "ì „êµ­ ë„ë§¤ì‹œì¥"

    PriceCompare:
      type: object
      properties:
        success:
          type: boolean
        date:
          type: string
          format: date
        wholesale_summary:
          type: object
          description: ë„ë§¤ê°€ ìš”ì•½ (ì›/kg)
          properties:
            high:
              type: integer
              description: ìƒí’ˆ
              example: 3480
            mid:
              type: integer
              description: ì¤‘í’ˆ
              example: 3120
            cherry:
              type: integer
              description: ë°©ìš¸í† ë§ˆí† 
              example: 6200
        online_summary:
          type: object
          description: ì˜¨ë¼ì¸ê°€ ìš”ì•½
          properties:
            lowest_price:
              type: integer
              example: 5800
            lowest_mall:
              type: string
              example: "ì±„ì†ŒíŒœ"
            lowest_title:
              type: string
              example: "ì±„ì†ŒíŒœ ì™„ìˆ™í† ë§ˆí†  1kg"
            lowest_link:
              type: string
              format: uri
              example: "https://smartstore.naver.com/main/products/10914338580"
            median_price:
              type: integer
              example: 14700
            highest_price:
              type: integer
              example: 23500
            average_price:
              type: integer
              example: 14398
            mall_count:
              type: integer
              example: 49
        comparison:
          type: array
          items:
            type: object
            properties:
              grade:
                type: string
              wholesale_price:
                type: integer
              online_lowest:
                type: integer
              margin_rate:
                type: integer
                description: ë§ˆì§„ìœ¨ (%)
        online_detail:
          type: array
          description: ì˜¨ë¼ì¸ ìƒí’ˆ ëª©ë¡ (ê°€ê²©ìˆœ)
          items:
            type: object
            properties:
              mall:
                type: string
              title:
                type: string
              price:
                type: integer
              price_per_kg:
                type: integer
              link:
                type: string
                format: uri
        sample_count:
          type: integer
          description: ë¹„êµ ëŒ€ìƒ ìƒí’ˆ ìˆ˜

    PriceHistory:
      type: object
      properties:
        success:
          type: boolean
        period:
          type: object
          properties:
            start:
              type: string
              format: date
            end:
              type: string
              format: date
        count:
          type: integer
          description: ë°ì´í„° ê±´ìˆ˜
        stats:
          type: object
          properties:
            high:
              $ref: '#/components/schemas/PriceStats'
            mid:
              $ref: '#/components/schemas/PriceStats'
            cherry:
              $ref: '#/components/schemas/PriceStats'
        data:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
              high:
                type: integer
              mid:
                type: integer
              cherry:
                type: integer

    PriceStats:
      type: object
      properties:
        min:
          type: integer
        max:
          type: integer
        avg:
          type: integer
        change:
          type: integer
          description: ê¸°ê°„ ë‚´ ë³€ë™

    YieldPredictionRequest:
      type: object
      required:
        - temperature
        - humidity
      properties:
        month:
          type: integer
          description: ì›” (1-12), ìƒëµì‹œ í˜„ì¬ ì›”
          example: 11
        temperature:
          type: number
          description: ì˜¨ë„ (Â°C)
          example: 25
        humidity:
          type: number
          description: ìŠµë„ (%)
          example: 70
        co2:
          type: number
          description: CO2 ë†ë„ (ppm)
          default: 700
          example: 800
        solar_radiation:
          type: number
          description: ì¼ì‚¬ëŸ‰ (J/ã /day)
          default: 1200
          example: 1500
        growth_stage:
          type: string
          description: ìƒìœ¡ ë‹¨ê³„
          enum:
            - ìƒìœ¡ì´ˆê¸°
            - ìƒìœ¡ì¤‘ê¸°(9~10ì›”)
            - ìƒìœ¡ì¤‘ê¸°(11~12ì›”)
            - ìƒìœ¡ì¤‘ê¸°(1~2ì›”)
            - ìƒìœ¡ì¤‘ê¸°(3~6ì›”)
            - ìƒìœ¡ë§ê¸°(7~8ì›”)
          example: "ìƒìœ¡ì¤‘ê¸°(11~12ì›”)"
        facility_type:
          type: string
          description: ì‹œì„¤ íƒ€ì…
          enum:
            - ë¹„ë‹í•˜ìš°ìŠ¤
            - ìœ ë¦¬ì˜¨ì‹¤
          default: ë¹„ë‹í•˜ìš°ìŠ¤

    YieldPredictionResponse:
      type: object
      properties:
        success:
          type: boolean
        predicted_yield:
          type: number
          description: ì˜ˆì¸¡ ìˆ˜í™•ëŸ‰ (kg/3.3ã¡)
          example: 2693.77
        predicted_yield_total:
          type: number
          description: ì´ ì˜ˆì¸¡ ìˆ˜í™•ëŸ‰ (kg)
          example: 816294.06
        confidence_interval:
          type: object
          properties:
            lower:
              type: number
              description: í•˜í•œê°’
              example: 2289.7
            upper:
              type: number
              description: ìƒí•œê°’
              example: 3097.84
            confidence_level:
              type: string
              example: "85%"
        model_used:
          type: string
          description: ì‚¬ìš©ëœ ëª¨ë¸
          example: "v3_vinyl"
        input_summary:
          type: object
          description: ì…ë ¥ ë°ì´í„° ìš”ì•½
          properties:
            temperature:
              type: number
            humidity:
              type: number
            month:
              type: integer
            facility_type:
              type: string
            area:
              type: integer
            has_historical_data:
              type: boolean
        recommendations:
          type: array
          items:
            type: string
          description: AI ì¶”ì²œ ì‚¬í•­

    DiaryEntry:
      type: object
      properties:
        date:
          type: string
          format: date
          description: ì¼ì§€ ë‚ ì§œ
        harvest_kg:
          type: number
          description: ìˆ˜í™•ëŸ‰ (kg)
        memo:
          type: string
          description: ë©”ëª¨

    DiaryListResponse:
      type: object
      properties:
        success:
          type: boolean
        entries:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
              ready:
                type: integer
              not_ready:
                type: integer
              disease:
                type: integer
              truss:
                type: integer
              memo:
                type: string
        total_days:
          type: integer

    HomeData:
      type: object
      properties:
        success:
          type: boolean
        realtime:
          $ref: '#/components/schemas/TomatoDataLowerCase'
        today_summary:
          type: object
          properties:
            total_detected:
              type: integer
              description: ê°ì§€ëœ ì´ í† ë§ˆí†  ìˆ˜
            total_ready:
              type: integer
              description: ìˆ˜í™• ê°€ëŠ¥ í† ë§ˆí†  ìˆ˜
            total_disease:
              type: integer
              description: ë³‘í•´ í† ë§ˆí†  ìˆ˜
            harvest_rate:
              type: number
              description: ì„±ìˆ™ë¥  (%)
              example: 73
        alerts:
          type: array
          items:
            type: object
            properties:
              type:
                type: string
                enum: [disease, harvest, warning]
              message:
                type: string
              time:
                type: string
                format: date-time
              severity:
                type: string
                enum: [low, medium, high, info]
        stream_url:
          type: string
          description: ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° URL
        last_updated:
          type: string
          format: date-time

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          description: ì—ëŸ¬ ë©”ì‹œì§€
        code:
          type: string
          description: ì—ëŸ¬ ì½”ë“œ